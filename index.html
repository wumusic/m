<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐</title>
    <style>
        html,
        body {
            padding: 0;
            margin: 0;
        }
    </style>
    <script src="jquery-1.9.1.min.js"></script>
    <script>
        var audio;
        var data = {
            "music": [
                {
                    "id": "1",
                    "audio": "1.mp3",
                    "name": "有鹤衔花"

                },
                {

                    "id": "2",
                    "audio": "2.mp3",
                    "name": "take me to your heart"
                },
                {
                    "id": "3",
                    "audio": "3.mp3",
                    "name": "冬意"
                },
                {

                    "id": "4",
                    "audio": "4.mp3",
                    "name": "下雨的时候大家都在干嘛"
                }

            ]
        }
        $(window).ready(
            function () {
                audio = document.getElementById("music");
            }
        )
        function playm() {
            var mindex = parseInt($("#music").attr("mindex")) - 1
            if (isNaN(audio.duration)) {
                audio.src = data.music[mindex].audio;
            }
            $("#music_name").html(data.music[mindex].name);
            if ($("#g_play").css("visibility") === "hidden") {
                $("#g_play").css("visibility", "visible")
                $("#g_pause").css("visibility", "hidden")
                clearTimeout(t);
                audio.pause();
            } else {
                $("#g_play").css("visibility", "hidden")
                $("#g_pause").css("visibility", "visible")
                clearTimeout(t);
                f();
                audio.play();
            }

        }
function replay(){
if (isNaN(audio.duration)) {
                        audio.src = data.music[mindex].audio;
                    }else{
                        $("#" + obj.attr("id") + "_g_play").css("visibility", "hidden")
                        $("#" + obj.attr("id") + "_g_pause").css("visibility", "visible")
                        //clearTimeout(t);
                        f();
                        audio.currentTime=0;
                        audio.play();
                    }
}

        function prevM() {
            if (parseInt($("#music").attr("mindex")) >1) {
               
                $("#music").attr("mindex", parseInt($("#music").attr("mindex")) - 1)
                var mindex=parseInt($("#music").attr("mindex")) - 1
                audio.src = data.music[mindex].audio;
                $("#music_name").html(data.music[mindex].name);
                $("#g_play").css("visibility", "hidden")
                $("#g_pause").css("visibility", "visible")
                clearTimeout(t);
                f();
                audio.play();
            }


        }
        function nextM() {
            if (parseInt($("#music").attr("mindex")) < data.music.length) {
                $("#music").attr("mindex", parseInt($("#music").attr("mindex")) + 1)
                var mindex=parseInt($("#music").attr("mindex")) - 1
                audio.src = data.music[mindex].audio;
                $("#music_name").html(data.music[mindex].name);
                $("#g_play").css("visibility", "hidden")
                $("#g_pause").css("visibility", "visible")
                clearTimeout(t);
                f();
                audio.play();
            }
        }
        var t;
        var strl = "LOADING"
        var strtime = ""
        var indexs = 0;
        function f() {

            t = setTimeout(function () {
                var curtt = parseInt(audio.currentTime);
                var fullt = parseInt(audio.duration);

                if (curtt === fullt) {
                    $("#g_play").css("visibility", "visible")
                    $("#g_pause").css("visibility", "hidden")
                    clearTimeout(t);
                    audio.pause();
                    audio.currentTime = 0;
                }
                $("#timeline").css("width", (curtt / fullt) * 100 + "%");
                if (isNaN(audio.duration)) {

                    if (indexs < strl.length) {
                        strtime += strl.charAt(indexs);
                        indexs += 1;
                        $("#time_txt").html(strtime);
                    } else {
                        indexs = 0;
                        strtime = "";
                        $("#time_txt").html(strtime);
                    }

                } else {
                    var t1 = parseInt(curtt / 60) >= 10 ? parseInt(curtt / 60) + ":" + (parseInt(curtt % 60) >= 10 ? parseInt(curtt % 60) : "0" + parseInt(curtt % 60)) : "0" + parseInt(curtt / 60) + ":" + (parseInt(curtt % 60) >= 10 ? parseInt(curtt % 60) : "0" + parseInt(curtt % 60));
                    var t2 = parseInt(audio.duration / 60) >= 10 ? parseInt(audio.duration / 60) + ":" + (parseInt(audio.duration % 60) >= 10 ? parseInt(audio.duration % 60) : "0" + parseInt(audio.duration % 60)) : "0" + parseInt(audio.duration / 60) + ":" + (parseInt(audio.duration % 60) >= 10 ? parseInt(audio.duration % 60) : "0" + parseInt(audio.duration % 60))
                    //console.log(parseInt(curtt / 60) >= 10 ? parseInt(curtt/ 60) + ":" + (parseInt(curtt % 60) >= 10 ? parseInt(curtt% 60) : "0" + parseInt(curtt% 60)) : "0" + parseInt(curtt / 60) + ":" + (parseInt(curtt% 60) >= 10 ? parseInt(curtt % 60) : "0" + parseInt(curtt % 60)))
                    $("#time_txt").html(t1 + "/" + t2);
                }
                f();
            }, 500)
        }
        function c() {
            var objLeft = $("#timebox").offset().left;
            var mouseX = event.clientX + document.body.scrollLeft;
            var objX = mouseX - objLeft;
            // console.log(objX);
            // console.log(objX * audio.duration / parseInt($("#timebox").width()));
            audio.currentTime = objX * audio.duration / parseInt($("#timebox").width());
            $("#timeline").css("width", (objX / parseInt($("#timebox").width())) * 100 + "%");
        }
    </script>
</head>

<body>
    <div style="background-color:#edeaea;width: 100%;height: 80px;display: grid;grid-template-columns: 80px auto;">
        <audio controls="controls" id="music" mindex="1" hidden="hidden"></audio>
        <div style="background-color:steelblue;height: 100%;width: 80px;"><svg viewBox="0 0 80 80" fill="#fff">
            <circle cx="23" cy="55" r="6" ></circle>
            <path d="m23 55 q10 10 8 -30h20q5 20 -3 28" fill="none" stroke="#fff" stroke-width="4"></path>
            <circle cx="45" cy="50" r="6" ></circle>
        </svg></div>
        <div style="display: grid; grid-template-rows: auto 3px;background-color:gray;width: 100%;height: 100%;">
            <div
                style="background-color: coral; display: grid; grid-template-columns: 40px 40px 40px 40px auto;grid-gap: 6px 6px; align-items: center;text-align: center;padding: 6px;">
                <div style="color:aqua" stroke="#fff" onclick="prevM()"><svg viewBox="0 0 40 40" stroke="#fff"
                        fill="#fff">
                        <circle cx="20" cy="20" r="15" stroke-width="3" fill="none"></circle>
                        <polygon points="10,20 18,10 18,20 26,10 26,30 18,20 18,30"></polygon>
                    </svg></div>
                <div onclick="playm()" state="pause"><svg viewBox="0 0 40 40" stroke="#fff" fill="#fff">
                        <circle cx="20" cy="20" r="15" stroke-width="3" fill="none"></circle>
                        <g id="g_play">
                            <polygon points="15,12 15,28 28,20"></polygon>
                        </g>
                        <g id="g_pause" style="visibility:hidden;">
                            <rect width="6" height="18" x="12" y="11"></rect>
                            <rect width="6" height="18" x="22" y="11"></rect>
                        </g>
                    </svg></div>
                <div onclick="replay()"><svg viewBox="0 0 40 40" stroke="#fff" fill="#fff">
                        <circle cx="20" cy="20" r="15" stroke-width="3" fill="none"></circle>
                        <!-- <circle cx="20" cy="20" r="8" stroke="black" stroke-width="4" fill="none"></circle> -->
                        <path d="m14 15 a8 8 0 1 1 0 10" stroke-width="4" fill="none" stroke-linecap="round" />
                    </svg></div>
                <div onclick="nextM()"><svg viewBox="0 0 40 40" stroke="#fff" fill="#fff">
                        <circle cx="20" cy="20" r="15" stroke-width="3" fill="none"></circle>
                        <polygon points="14,10, 14,30 22,20 22,30 30,20 22,10 22,20"></polygon>
                    </svg></div>
                <div style="color: #fff;">
                    <div id="music_name">music name</div>
                    <div id="time_txt"> 00:00/00:00</div>
                </div>
            </div>
            <div id="timebox" style="background-color:gray;width:100%;" onclick="c()">
                <div id="timeline" style="background-color:cornflowerblue;width:0;height: 100%;"></div>
            </div>
        </div>
    </div>
</body>

</html>
